// Investment Questionnaire code written by Anthony Hayes
// Comments generated by ChatGPT
import React, { useState } from "react";
import { useNavigate } from "react-router-dom"; // React Router hook for navigation
import "./Investment-Questionnaire.css"; // Ensure the correct path for styling
import getPortfolioRecommendation from "../filtering_logic/portfolioLogic"; // Import portfolio logic function
import { db, auth } from "../firebase"; // Import Firestore db instance
import { doc, setDoc, serverTimestamp } from "firebase/firestore"; // Firestore functions to set data
import { Button, Dropdown } from "react-bootstrap"; // React Bootstrap UI components (Button and Dropdown)

const InvestmentQuestionnaire = () => {
  // State to hold answers to the questionnaire
  const [answers, setAnswers] = useState({
    question1: "",
    question2: "",
    question3: "",
    question4: "",
    question5: "",
    question6: "",
    question7: "",
    question8: "",
    question9: "",
    question10: "",
  });

  const [portfolio, setPortfolio] = useState(null); // State to store the portfolio recommendation
  const [isMenuOpen, setIsMenuOpen] = useState(false); // State to toggle the menu visibility
  const navigate = useNavigate(); // React Router hook to navigate between pages

  // Handle changes in form inputs
  const handleChange = (e) => {
    const { name, value } = e.target; // Destructure name and value from the event target
    setAnswers((prevAnswers) => ({
      ...prevAnswers, // Keep previous answers intact
      [name]: value, // Update the answer for the specific question
    }));
  };

  // Handle form submission and save data
  const handleSubmit = async (e) => {
    e.preventDefault(); // Prevent default form submission

    // Get portfolio recommendation based on user's answers
    const recommendation = getPortfolioRecommendation(answers);
    setPortfolio(recommendation); // Save the recommendation to the state

    // Optionally log the answers and the calculated recommendation
    console.log("User's answers:", answers);
    console.log("Portfolio Recommendation:", recommendation);

    // Save user's answers and recommendation to Firebase Firestore
    try {
      const userRef = doc(db, "investmentQuestionnaires", "user_id"); // Reference to the Firestore document
      await setDoc(userRef, {
        answers, // Store answers
        recommendation, // Store portfolio recommendation
        timestamp: serverTimestamp(), // Store the current timestamp
      });
      console.log("Data successfully saved to Firebase!");

      // Navigate to the recommendation page and pass the portfolio recommendation as state
      navigate("/recommendation", { state: { recommendation } });
    } catch (error) {
      console.error("Error saving to Firebase: ", error); // Log error if saving fails
    }
  };

  return (
    <div className="investment-questionnaire">
      <h2>Investment Risk Questionnaire</h2>

      {/* Menu Button to toggle visibility of the menu */}
      <Button
        variant="primary"
        onClick={() => setIsMenuOpen(!isMenuOpen)} // Toggle menu open/close state
        className="mb-3"
      >
        Menu
      </Button>

      {/* Dropdown menu that appears when the menu is toggled */}
      {isMenuOpen && (
        <Dropdown.Menu show>
          <Dropdown.Item onClick={() => navigate("/dashboard")}>
            Dashboard
          </Dropdown.Item>
          <Dropdown.Item onClick={() => navigate("/profile")}>
            Profile
          </Dropdown.Item>
          <Dropdown.Item onClick={() => navigate("/friend-system")}>
            Friends
          </Dropdown.Item>
          <Dropdown.Item onClick={() => navigate("/investment-questionnaire")}>
            Investment Questionnaire
          </Dropdown.Item>
          <Dropdown.Item onClick={() => navigate("/settings")}>
            Settings
          </Dropdown.Item>
          <Dropdown.Item onClick={() => auth.signOut()}>Log Out</Dropdown.Item>
        </Dropdown.Menu>
      )}

      {/* Form to capture user answers to the investment risk questions */}
      <form onSubmit={handleSubmit}>
        {/* Question 1 */}
        <div>
          <label>
            1. How would you describe your general attitude towards risk in
            investing?
          </label>
          <select
            name="question1" // Unique name to identify the input field
            value={answers.question1} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Low Risk">
              Low Risk (Prefer safe investments with little chance of loss)
            </option>
            <option value="Medium Risk">
              Medium Risk (Willing to take some risks for moderate returns)
            </option>
            <option value="High Risk">
              High Risk (Comfortable with high-risk investments for potentially
              high returns)
            </option>
          </select>
        </div>

        {/* Question 2 */}
        <div>
          <label>
            2. How much of a financial loss would you be comfortable with on
            your investments?
          </label>
          <select
            name="question2" // Unique name to identify the input field
            value={answers.question2} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Minimal Loss">
              Minimal Loss (No more than 5% loss)
            </option>
            <option value="Moderate Loss">
              Moderate Loss (Losses up to 15% are acceptable)
            </option>
            <option value="Significant Loss">
              Significant Loss (Willing to accept losses over 20%)
            </option>
          </select>
        </div>

        {/* Question 3 */}
        <div>
          <label>3. How long do you intend to keep your investments?</label>
          <select
            name="question3" // Unique name to identify the input field
            value={answers.question3} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Short-Term">Short-Term (1-3 years)</option>
            <option value="Medium-Term">Medium-Term (3-7 years)</option>
            <option value="Long-Term">Long-Term (7+ years)</option>
          </select>
        </div>

        {/* Question 4 */}
        <div>
          <label>
            4. How would you feel if your investments lost value over the short
            term?
          </label>
          <select
            name="question4" // Unique name to identify the input field
            value={answers.question4} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Very Uncomfortable">
              Very Uncomfortable (I would panic and sell)
            </option>
            <option value="Somewhat Uncomfortable">
              Somewhat Uncomfortable (I may feel uneasy, but I could manage)
            </option>
            <option value="Comfortable">
              Comfortable (I trust the market's long-term growth)
            </option>
          </select>
        </div>

        {/* Question 5 */}
        <div>
          <label>
            5. If you experienced a loss in your investments, how would it
            affect your lifestyle?
          </label>
          <select
            name="question5" // Unique name to identify the input field
            value={answers.question5} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Significantly">
              Significantly (It would impact my financial well-being)
            </option>
            <option value="Moderately">
              Moderately (It might affect my discretionary spending)
            </option>
            <option value="Slightly">
              Slightly (I have other sources of income and savings)
            </option>
          </select>
        </div>

        {/* Question 6 */}
        <div>
          <label>
            6. How frequently do you plan to check or manage your investments?
          </label>
          <select
            name="question6" // Unique name to identify the input field
            value={answers.question6} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Daily">Daily</option>
            <option value="Weekly">Weekly</option>
            <option value="Monthly">Monthly</option>
            <option value="Rarely">Rarely</option>
          </select>
        </div>

        {/* Question 7 */}
        <div>
          <label>
            7. How comfortable are you with the idea of losing money on
            investments in exchange for higher returns in the future?
          </label>
          <select
            name="question7" // Unique name to identify the input field
            value={answers.question7} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Not Comfortable">
              Not Comfortable (I prefer low-risk, low-return investments)
            </option>
            <option value="Somewhat Comfortable">
              Somewhat Comfortable (I’m okay with some risk)
            </option>
            <option value="Very Comfortable">
              Very Comfortable (I’m willing to take substantial risk for high
              returns)
            </option>
          </select>
        </div>

        {/* Question 8 */}
        <div>
          <label>
            8. How do you feel about diversifying your investments into
            different types of assets (stocks, bonds, real estate)?
          </label>
          <select
            name="question8" // Unique name to identify the input field
            value={answers.question8} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Uncomfortable">
              Uncomfortable (I prefer to stick with one asset type)
            </option>
            <option value="Neutral">
              Neutral (I’m okay with some diversification)
            </option>
            <option value="Comfortable">
              Comfortable (I believe diversification reduces risk)
            </option>
          </select>
        </div>

        {/* Question 9 */}
        <div>
          <label>
            9. What would you do if the stock market dropped by 20% in the next
            month?
          </label>
          <select
            name="question9" // Unique name to identify the input field
            value={answers.question9} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Sell Everything">
              Sell Everything (I would cut my losses and exit the market)
            </option>
            <option value="Hold for a while">
              Hold for a while (I’d wait to see if it recovers)
            </option>
            <option value="Buy More">
              Buy More (I’d take advantage of lower prices)
            </option>
          </select>
        </div>

        {/* Question 10 */}
        <div>
          <label>10. What is your age group?</label>
          <select
            name="question10" // Unique name to identify the input field
            value={answers.question10} // Current value of this question's answer
            onChange={handleChange} // Handle change in this input
          >
            <option value="">Select your answer</option>
            <option value="Under 25">Under 25</option>
            <option value="25-35">25-35</option>
            <option value="36-50">36-50</option>
            <option value="50+">50+</option>
          </select>
        </div>

        {/* Submit button to submit the form */}
        <button type="submit">Submit</button>
      </form>
    </div>
  );
};

export default InvestmentQuestionnaire;
